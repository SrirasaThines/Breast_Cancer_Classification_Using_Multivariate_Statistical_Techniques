---
title: "Mini Project"
author: "Thineskumar"
date: "2025-05-10"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Principal Component Analysis

#Load the libraries
```{r}
library(tidyverse)
library(gridExtra)
library(ggplot2)
library(ggcorrplot)
library(knitr)
library(FactoMineR)
library(factoextra)
library(corrr)
library(readr)
library(psych)
library(skimr)
library(performance)
library(GPArotation)
library(lavaan)
library(GGally)
library(CCA)
library(CCP)
```


#Load Dataset
```{r}
breast_cancer<- read.table("D:/4th Year/Semester 01/DSC4033 Multivariate Methods II/Tutorial/Mini Project/wdbc.data", header = FALSE, sep=",")

```

```{r}
head(breast_cancer)
```

```{r}
colnames(breast_cancer)<-c("ID","Diagnosis","radius1","texture1","perimeter1","area1","smoothness1","compactness1","concavity1","concave_points1","symmetry1","fractal_dimension1","radius2","texture2","perimeter2","area2","smoothness2","compactness2","concavity2","concave_points2","symmetry2","fractal_dimension2","radius3","texture3","perimeter3","area3","smoothness3","compactness3","concavity3","concave_points3","symmetry3","fractal_dimension3")
```

```{r}
str(breast_cancer)
```
```{r}
dim(breast_cancer)
```
```{r}
colSums(is.na(breast_cancer))
```


Remove the unwanted Columns

```{r}
breast_cancer<- breast_cancer[,3:32]
head(breast_cancer)
```
#mean of each variable
```{r}
apply(breast_cancer, 2, mean)
```
#Variance of each variable
```{r}
apply(breast_cancer, 2, var)
```

#Correlation matrix for the data
```{r}
cor_matrix<- cor(breast_cancer, method = "spearman")
cor_matrix
```
```{r}
pca_cor_matrix <- ggcorrplot(cor_matrix)
pca_cor_matrix
```
```{r}
breast_cancer <- subset(breast_cancer,select = -c(1,11,21))
head(breast_cancer)
```
```{r}
cor_matrix<- cor(breast_cancer, method = "spearman")
ggcorrplot(cor_matrix)
```

#Standardizing each variable
```{r}
scaled_breast_cancer<- apply(breast_cancer, 2, scale)
head(scaled_breast_cancer)
```
# Calculate eigenvalues & eigen vectors
```{r}
breast_cancer_cov<- cov(scaled_breast_cancer)
breast_cancer_eigen<- eigen(breast_cancer_cov)
breast_cancer_eigen
```

```{r}
breast_cancer_load<-breast_cancer_eigen$vectors
breast_cancer_load<- -breast_cancer_load
row.names(breast_cancer_load)<- c("texture1","perimeter1","area1","smoothness1","compactness1","concavity1","concave_points1","symmetry1","fractal_dimension1","texture2","perimeter2","area2","smoothness2","compactness2","concavity2","concave_points2","symmetry2","fractal_dimension2","texture3","perimeter3","area3","smoothness3","compactness3","concavity3","concave_points3","symmetry3","fractal_dimension3")
colnames(breast_cancer_load)<- c("PC1", "PC2", "PC3", "PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10", "PC11", "PC12","PC13", "PC14", "PC15", "PC16", "PC17", "PC18","PC19", "PC20", "PC21", "PC22", "PC23", "PC24", "PC25", "PC26", "PC27")
breast_cancer_load
```

#The proportion of variance explained (PVE)
```{r}
PVE <- breast_cancer_eigen$values / sum(breast_cancer_eigen$values)
round(PVE, 3)
```

```{r}
sum(breast_cancer_eigen$values)
```

```{r}
sum(PVE)
```

#Built in PCA Functions
```{r}
pca_result <- prcomp(breast_cancer, scale. = TRUE)
names(pca_result)
```
#means
```{r}
pca_result$center
```

#standard deviation
```{r}
pca_result$scale
```

#loading matrix
```{r}
pca_result$rotation
```

#Principal components scores
```{r}
head(pca_result$x)
```
#Standard deviation of each principal component
```{r}
pca_result$sdev
```
#variance explained by each principal components
```{r}
VE<-pca_result$sdev^2
VE
```
```{r}
PVE <- VE / sum(VE)
round(PVE, 3)
```
Scree plot
```{r}
scree_plot <-fviz_eig(pca_result, addlabels = TRUE, ylim = c(0, 50))
scree_plot
```
According to the scree plot we select first 6 pricipal components.

#Loading Matr
```{r}
pca_result$rotation[,1:6]
```

#Graph of variables
```{r}
fviz_pca_var(pca_result, col.var = "contrib", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), repel = TRUE )
```

#Biplot of individuals and variables
```{r}
fviz_pca_biplot(pca_result, 
                col.var = "#2E9FDF", # Variables color 
                col.ind = "#696969" # Individuals color 
                )
```
#Quality of Reperesentation
```{r}
var <- get_pca_var(pca_result) 
head(var$cos2, 30)
```

```{r}
library(corrplot)
corrplot(var$cos2, is.corr = FALSE)
```



#Factor Analysis

Kaiser-Meyer-Oklin Test (KMO)

#It's MSA value must be greater than 0.60. If it's not we need to remove the variables which not take the part of factor analysis.To do so drop the indiacator varibles with the lowest individuals KMO statistic values, unril KMO overall rises above 0.60.
```{r}
KMO(scaled_breast_cancer)
```


Remove all low contribution varibles to increse the MSA value 
```{r}
new_breast_cancer<- scaled_breast_cancer[, KMO(scaled_breast_cancer)$MSAi > 0.5]
round(KMO(new_breast_cancer)$MSA,2)
```

H0: Correlation matrix is an idnetity matrix Vs. H1: Correlation matrix is different from an identity matrix
```{r}
cortest.bartlett(new_breast_cancer)
```
p-value < 0.05. So, we reject H0. 
We can caonclude that correlation matrix is significantly different from an identity matrix at 5% significant level. Suggesting that factor Analyisis is appropriate.






Get the covariance matrix of standardize data
```{r}
breast_cancer_cov <- cov(scaled_breast_cancer)
breast_cancer_cov
```

Calculate eigen value and eigen vector
```{r}
breast_cancer_eigen <- eigen(breast_cancer_cov)

# eigen values
breast_cancer_eigen$values
```

```{r}
# eigen vectors
breast_cancer_eigen$vectors
```
proportion of variance explained
```{r}
PVE <- breast_cancer_eigen$values / sum(breast_cancer_eigen$values)
round(PVE,3)
sum(breast_cancer_eigen$values)
sum(PVE)
```
Scree plot
```{r}
scree(breast_cancer)
```

Parallel analysis and scree plots
```{r}
fa.parallel(breast_cancer,fm="pa",fa="fa")
```


Factor Analysis using 'Principal Component Method'
```{r}
breast_cancer_PC<- fa(breast_cancer_cov ,nfactors = 6,rotate = "none",n.obs = 500 ,covar = TRUE,fm = "pa")
breast_cancer_PC
```

Get unrotated loading from PC method
```{r}
#gas_turbine_PC$loadings
unrotated_pc_loadings <- as.data.frame(unclass(breast_cancer_PC$loadings))
unrotated_pc_loadings
```
Communalities
```{r}
unrotated_pc_com <- as.data.frame(unclass(breast_cancer_PC$communality))
unrotated_pc_com
```

Factor Analysis Using 'Maximum Likelihood Method
```{r}
breast_cancer_ML <- fa(breast_cancer_cov,nfactors = 6,rotate = "none",n.obs = 500 , covar = TRUE, fm = 'ml')
breast_cancer_ML
```

Get unrotated ML loadings
```{r}
#df_st_fa_ml$loadings
unrotated_ml_loadings <- as.data.frame(unclass(breast_cancer_ML$loadings))
unrotated_ml_loadings
```
Communalities
```{r}
unrotated_ml_com <- as.data.frame(unclass(breast_cancer_ML$communality))
unrotated_ml_com
```

Rotate the PC method factor loadings using 'Varimax' method
```{r}
breast_cancer_PC_rotate <- fa(breast_cancer_cov ,nfactors = 6,rotate = "varimax",n.obs = 500 ,covar = TRUE,fm = 'pa')
breast_cancer_PC_rotate
```

```{r}
rotated_pc_loadings <- as.data.frame(unclass(breast_cancer_PC_rotate$loadings))
rotated_pc_loadings
```

Get rotated communalities in PC method
```{r}
rotated_pc_com <- as.data.frame(unclass(breast_cancer_PC_rotate$communality))
rotated_pc_com
```

Graph Factor Loading Matrices
```{r}
fa.diagram(breast_cancer_PC_rotate)
```






```{r}
str(scaled_breast_cancer)
```


Confirmatory Factor Analysis
```{r}
variables<- scaled_breast_cancer[,c("texture1","perimeter1","area1","smoothness1","compactness1","concavity1","concave_points1","symmetry1","fractal_dimension1","texture2","perimeter2","area2","smoothness2","compactness2","concavity2","concave_points2","symmetry2","fractal_dimension2","texture3","perimeter3","area3","smoothness3","compactness3","concavity3","concave_points3","symmetry3","fractal_dimension3")]
```

Defined the CFA model
```{r}
model<- '
  Factor1 =~  texture1 + perimeter1 + area1 + concavity1 + concave_points1 + perimeter2 + area2 + texture3 + perimeter3 + area3 + concave_points3
  Factor2 =~ smoothness1 + compactness1 + symmetry1 + fractal_dimension1 + texture2 + smoothness2 + compactness2 + concavity2 + concave_points2 + symmetry2 + fractal_dimension2 + smoothness3 + compactness3 + concavity3 + symmetry3 + fractal_dimension3
'
```


Fit the CFA model
```{r}
fit <- cfa(model, data=variables)
```

```{r}
inspect(fit, "converged")

```
```{r}
varTable(fit)

```


Asses model fit
```{r}
summary(fit, fit.measure=TRUE)
```

standardized estimates (factor loadings)
```{r}
parameterEstimates(fit, standardized = TRUE, ci = TRUE)
```



#Canonical Correlation Analysis
```{r}
breast_cancer_data<-read.table("D:/4th Year/Semester 01/DSC4033 Multivariate Methods II/Tutorial/Mini Project/wdbc.data", header = FALSE, sep=",")
head(breast_cancer_data)
```
```{r}
colnames(breast_cancer_data)<-c("ID","Diagnosis","radius1","texture1","perimeter1","area1","smoothness1","compactness1","concavity1","concave_points1","symmetry1","fractal_dimension1","radius2","texture2","perimeter2","area2","smoothness2","compactness2","concavity2","concave_points2","symmetry2","fractal_dimension2","radius3","texture3","perimeter3","area3","smoothness3","compactness3","concavity3","concave_points3","symmetry3","fractal_dimension3")
```


```{r}
X <- breast_cancer_data[,3:12]
head(X)
```
```{r}
Y <- breast_cancer_data[,13:22]
head(Y)
```

```{r}
ggpairs(X)
```
```{r}
ggpairs(Y)
```


#Correlations within and between the two sets of variables using the matcor function
```{r}
matcor(X, Y)
```
#Compute canonical correlation 
```{r}
cc1 <- cc(X, Y)
cc1$cor
```

```{r}
barplot(cc1$cor,main="Canonical correlation",ylim = c(0,1))
```


#Canonical Coffecients
```{r}
cc1[3:4]
```
#Compute the loadings of the variables on the canonical dimensions(variates).
```{r}
#Compute canonical loadings
cc2 <- comput(X, Y, cc1)

#display the canonical loadings
cc2[3:6]
```
#tests of canonical dimensions
```{r}
rho <- cc1$cor

#define the number of observations, number of variables in first set , and the number of variables in the seconed set

n <- dim(X)[1]
p <- length(X)
q<- length(Y)

## Calculate p-values using the F-approximations of different test statistics:
p.asym(rho, n, p, q, tstat = "Wilks")
```

```{r}
p.asym(rho, n, p, q, tstat = "Hotelling")
```

```{r}
p.asym(rho, n, p, q, tstat = "Pillai")
```

```{r}
p.asym(rho, n, p, q, tstat = "Roy")
```
The first test of the canonical dimensions tests whether all 10 dimensions are significant, the next test tests whether dimendion 2 to 10 are significant so on,the last test tests whether dimension 10 by itself, is significant. All p-value are less than 0.05 other than last one. So, we can conclude that the all other dimensions are significant except dimension 10.

,

#Discriminant Analysis


```{r}
library(tidyverse)
library(MASS)
library(klaR)
```

```{r}
da_breast_cancer<- breast_cancer<- read.table("D:/4th Year/Semester 01/DSC4033 Multivariate Methods II/Tutorial/Mini Project/wdbc.data", header = FALSE, sep=",")
colnames(da_breast_cancer)<-c("ID","Diagnosis","radius1","texture1","perimeter1","area1","smoothness1","compactness1","concavity1","concave_points1","symmetry1","fractal_dimension1","radius2","texture2","perimeter2","area2","smoothness2","compactness2","concavity2","concave_points2","symmetry2","fractal_dimension2","radius3","texture3","perimeter3","area3","smoothness3","compactness3","concavity3","concave_points3","symmetry3","fractal_dimension3")
head(da_breast_cancer)
```

Remove the ID column
```{r}
da_breast_cancer<- da_breast_cancer[,2:32]
str(da_breast_cancer)
```
```{r}
attach(da_breast_cancer)
```

#Bartlett's Test
```{r}
bartlett.test(radius1~Diagnosis)
bartlett.test(texture1~Diagnosis)
bartlett.test(perimeter1~Diagnosis)
bartlett.test(area1~Diagnosis)
bartlett.test(smoothness1~Diagnosis)
bartlett.test(compactness1~Diagnosis)
bartlett.test(concavity1~Diagnosis)
bartlett.test(concave_points1~Diagnosis)
bartlett.test(symmetry1~Diagnosis)
bartlett.test(fractal_dimension1~Diagnosis)
bartlett.test(radius2~Diagnosis)
bartlett.test(texture2~Diagnosis)
bartlett.test(perimeter2~Diagnosis)
bartlett.test(area2~Diagnosis)
bartlett.test(smoothness2~Diagnosis)
bartlett.test(compactness2~Diagnosis)
bartlett.test(concavity2~Diagnosis)
bartlett.test(concave_points2~Diagnosis)
bartlett.test(symmetry2~Diagnosis)
bartlett.test(fractal_dimension2~Diagnosis)
bartlett.test(radius3~Diagnosis)
bartlett.test(texture3~Diagnosis)
bartlett.test(perimeter3~Diagnosis)
bartlett.test(area3~Diagnosis)
bartlett.test(smoothness3~Diagnosis)
bartlett.test(compactness3~Diagnosis)
bartlett.test(concavity3~Diagnosis)
bartlett.test(concave_points3~Diagnosis)
bartlett.test(symmetry3~Diagnosis)
bartlett.test(fractal_dimension3~Diagnosis)
```

Bartlett's test p-value for texture1, smoothness1, symmetry1, fractal_dimension1, smoothness2, compactnesss2, concave_points2, texture3,smoothness3 are greater than 0.05.
p-value for other variabes are <0.05. So, we reject the H0.

So, we will use Quadratic Discriminant Analysis

#QDA
#preparing the Data
```{r}
training_sample <- sample(c(TRUE, FALSE), nrow(da_breast_cancer), replace = T, prob = c(0.8,0.2))
train <- da_breast_cancer[training_sample, ]
test <- da_breast_cancer[!training_sample,]
test <- da_breast_cancer[!training_sample, ]
```

```{r}
dim(train)
```

```{r}
dim(test)
```
```{r}
qda_model <- qda(Diagnosis~ radius1 + texture1 + perimeter1  + area1 + smoothness1  + compactness1 + concavity1 + concave_points1 + symmetry1 + fractal_dimension1 + radius2 + texture2 + perimeter2 + area2 + smoothness2 + compactness2 + concavity2 + concave_points2 + symmetry2 +fractal_dimension2 + radius3 + texture3 + perimeter3  + area3 + smoothness3 + compactness3 + concavity3 + concave_points3 + symmetry3 + fractal_dimension3, data = train)
qda_model
```



#QDA Predictions
```{r}
qda.train <- predict(qda_model)
train$qda <- qda.train$class
table(train$qda,train$Diagnosis)
```
```{r}
qda.test <- predict(qda_model,test)
test$qda <- qda.test$class
table(test$qda,test$Diagnosis)
```

#Structural Equation Modelling (SEM)

```{r}
library(lavaan)
library(semPlot)
```
```{r}
sem_data<-read.table("D:/4th Year/Semester 01/DSC4033 Multivariate Methods II/Tutorial/Mini Project/wdbc.data", header = FALSE, sep=",")
colnames(sem_data)<-c("ID","Diagnosis","radius1","texture1","perimeter1","area1","smoothness1","compactness1","concavity1","concave_points1","symmetry1","fractal_dimension1","radius2","texture2","perimeter2","area2","smoothness2","compactness2","concavity2","concave_points2","symmetry2","fractal_dimension2","radius3","texture3","perimeter3","area3","smoothness3","compactness3","concavity3","concave_points3","symmetry3","fractal_dimension3")
```

```{r}
sem_data<- sem_data[,2:32]
head(sem_data)
```

```{r}
scale_sem_data <- sem_data %>%
  dplyr::select( radius1, texture1, perimeter1, area1, smoothness1, compactness1, concavity1, concave_points1, symmetry1, fractal_dimension1, radius2, texture2, perimeter2, area2, smoothness2, compactness2, concavity2, concave_points2, symmetry2, fractal_dimension2, radius3, texture3, perimeter3, area3, smoothness3, compactness3, concavity3, concave_points3, symmetry3, fractal_dimension3) %>%
  scale() %>% as.data.frame()
```

```{r}
Diagnosis<- sem_data$Diagnosis
```

```{r}
sem_data<- cbind(Diagnosis, scale_sem_data)
```

```{r}
head(sem_data)
```

```{r}
sem_data$Diagnosis <- ifelse(sem_data$Diagnosis == "M", 1, 0)
```

```{r}
model_1<-  '
 compactness1 ~ perimeter1 + area1
 compactness2 ~  area2
 compactness3 ~  area3
 shape1 =~ radius1 + texture1  + smoothness1 + compactness1 + concavity1 + concave_points1 + symmetry1 + fractal_dimension1
 shape2 =~ radius2 + texture2 + smoothness2 + compactness2 + concavity2 + concave_points2 + symmetry2 + fractal_dimension2
 shape3 =~ radius3 + texture3  + smoothness3 + compactness3 + concavity3 + concave_points3 + symmetry3 + fractal_dimension3
 Diagnosis ~  shape1 + shape2 + shape3
 '
fit_1 <- sem(model_1, data=sem_data)
summary(fit_1, fit.measures=TRUE)
```



#Paths
```{r}
semPaths(fit_1, whatLabels = "std", layout = "tree", edge.label.cex = 0.8)
```

#Plots
```{r}
#library(semPlot)

# Plot the SEM model with standardized estimates
semPaths(fit_1, 
         whatLabels = "std",        # Use standardized coefficients
         layout = "tree",           # Tree layout is clean and readable
         edge.label.cex = 1.0,        # Path coefficient font size
         label.cex =2.5,      # Size of path coefficients
         sizeMan = 8,               # Size of manifest variables
         sizeLat = 8,               # Size of latent variables (if any)
         nCharNodes = 0,            # Show full variable names
         color = list(lat = "skyblue", man = "lightblue"),  # Customize colors
         edge.color = "black",      # Path line color
         fade = FALSE,              # Use solid color
         title = FALSE)
```

